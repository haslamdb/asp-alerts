# NHSN HAI Reporting Dashboard - Redirect Configuration
# Subdomain: nhsn.aegis-asp.com (DEPRECATED - redirect to main domain)
#
# This config redirects the old nhsn.aegis-asp.com subdomain to the
# main aegis-asp.com domain. The NHSN functionality is now at:
# - https://aegis-asp.com/hai-detection/ (candidate review)
# - https://aegis-asp.com/nhsn-reporting/ (data submission)
#
# Setup:
# 1. Copy to: /etc/nginx/sites-available/nhsn-aegis
# 2. Enable:  sudo ln -s /etc/nginx/sites-available/nhsn-aegis /etc/nginx/sites-enabled/
# 3. Get SSL: sudo certbot certonly --webroot -w /var/www/certbot -d nhsn.aegis-asp.com
# 4. Reload:  sudo nginx -t && sudo systemctl reload nginx

# HTTP - Redirect to main domain
server {
    listen 80;
    listen [::]:80;
    server_name nhsn.aegis-asp.com;

    # Allow Let's Encrypt challenge
    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }

    # Redirect all traffic to main domain
    location / {
        return 301 https://aegis-asp.com$request_uri;
    }
}

# HTTPS - Redirect to main domain
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name nhsn.aegis-asp.com;

    # SSL Configuration - Let's Encrypt
    ssl_certificate /etc/letsencrypt/live/nhsn.aegis-asp.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/nhsn.aegis-asp.com/privkey.pem;
    ssl_session_timeout 1d;
    ssl_session_cache shared:SSL_nhsn:10m;
    ssl_session_tickets off;

    # Modern SSL configuration
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;

    # Redirect old NHSN routes to new structure
    location /nhsn/ {
        return 301 https://aegis-asp.com/hai-detection/;
    }

    # Redirect everything else to main domain
    location / {
        return 301 https://aegis-asp.com$request_uri;
    }
}
